---
import Layout from "../../../layouts/Global.astro"
import { getCollection, CollectionEntry } from "astro:content";
import ContentBlock from '../../../components/ContentBlock.astro'
import type {blogg} from '../../../schemas'
import customParseFormat from 'dayjs/plugin/customParseFormat';
import {sort_} from '../../../utils'

export async function getStaticPaths() {
  const allPosts = await getCollection("blogs");
  const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) =>
      post.data.tags.includes(tag)
    );
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props; 


const sortedblogs = sort_(posts);

// console.log(sortedblogs[0])
---

<Layout
  title="Frank"
  description="I'm Frank. I occasionally publish articles about programming and tech."
>
  <h1
    class="text-xl md:text-2xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent"
  >
  Article with Tag: <span class="tag-name">{tag}</span>
  </h1>
  <p class="text-neutral-400 text-sm mt-1 mb-3">
    I may write when I don't have a good mood<br>
  </p>
  <div class="flex flex-wrap gap-3">
    {
      sortedblogs.map((blog) => (
        <ContentBlock blog={blog} ishome={false}/>
      ))
    }
  </div>
</Layout>

<style>
  .tag-name {
    text-decoration: none;
    color: #ffe3e3;
    font-weight: 700;
    position: relative;
  }
  .tag-name::before {
  content: '';
  background: linear-gradient(60deg, #bc5dc7 0%, #f5576c 100%);
  position: absolute;
  left: 0;
  bottom: 3px;
  width: 100%;
  height: 8px;
  z-index: -1;
  transition: all .3s ease-in-out;
}

.tag-name:hover::before {
  bottom: 0;
  height: 100%;
}
</style>